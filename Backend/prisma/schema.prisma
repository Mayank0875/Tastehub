generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Problem {
  id           Int          @id @default(autoincrement())
  title        String       @unique
  rating       Int
  tags         Json
  description  String       @db.Text
  constraints  String       @db.Text
  sampleInput  String       @db.Text
  sampleOutput String       @db.Text
  notes        String       @db.Text
  createdBy    Int?         // User ID who created the problem
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  submission   Submission[]
  testCases    TestCase[]
  creator      User?        @relation("ProblemCreator", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([createdBy])
}

model TestCase {
  id        Int     @id @default(autoincrement())
  problemId Int
  input     String  @db.Text
  output    String  @db.Text
  problem   Problem @relation(fields: [problemId], references: [id], onDelete: Cascade)

  @@index([problemId])
}

model User {
  id              Int          @id @default(autoincrement())
  username        String       @unique
  email           String       @unique
  password        String
  role            String       @default("USER") // USER, ADMIN
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  submission      Submission[]
  createdProblems Problem[]    @relation("ProblemCreator")
}

model Submission {
  id          Int      @id @default(autoincrement())
  userId      Int
  problemId   Int
  code        String   @db.Text
  language    String
  verdict     String
  submittedAt DateTime @default(now())
  problem     Problem  @relation(fields: [problemId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([problemId])
  @@index([userId])
}

model Contest {
  id          Int      @id @default(autoincrement())
  name        String
  description String   @db.Text
  problemIds  Json     // Array of problem IDs
  startsAt    DateTime
  endsAt      DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
